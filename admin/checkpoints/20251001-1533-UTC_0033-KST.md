---
file: admin/checkpoints/20251001-1533-UTC_0033-KST.md
title: Guardrail 프리플라이트 및 Dry Run 실패 보고 강화
owner: duksan
created: 2025-10-01 15:33 UTC / 2025-10-02 00:33 KST
updated: 2025-10-01 16:11 UTC / 2025-10-02 01:11 KST
status: in_progress
tags: [checkpoint, figma, guardrail]
schemaVersion: 1
description: Dry Run 전에 Guardrail 임계치를 선제 차단하고 실패 시 UI에 즉시 보고가 남도록 런타임/스토어를 조정했다.
---

## Summary

- Guardrail 임계값과 노드 수 계산 로직을 `src/shared/guardrails.ts`로 공용화하고 UI에서 프리플라이트 검사를 수행하도록 `guardrail-preflight` 서비스를 추가했다.
- `useExecutionModel`이 Dry Run 전 경고·오류를 Guardrail Summary에 기록하고, 임계 초과 시 실행을 중단하도록 개선했다.
- 런타임 `runSchemaDocument`가 Guardrail 실패 시에도 Dry Run 결과 메시지를 전송하여 UI 로그와 Summary에 실패 원인이 남도록 했다.
- Preflight 로직을 검증하는 `ui-guardrail-preflight` 테스트를 추가하고 관련 계획 문서(roadmap/refactor)에 Guardrail 보강 사실을 반영했다.

## Impacted files

- figma-hello-plugin/src/shared/guardrails.ts (new)
- figma-hello-plugin/src/runtime/guardrails/counters.ts
- figma-hello-plugin/src/runtime/guardrails/thresholds.ts
- figma-hello-plugin/src/runtime/executor/index.ts
- figma-hello-plugin/src/ui/services/guardrail-preflight.ts (new)
- figma-hello-plugin/src/ui/hooks/useExecutionModel.ts
- figma-hello-plugin/tests/ui-guardrail-preflight.test.ts (new)
- admin/plan/legacy/figmaplugin-refactor.md
- admin/plan/figmaplugin-roadmap.md

## Tests

- pnpm --filter gg-figma-plugin test
